<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/c81a1e63cb.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="./css/styles.css">
  <title>Turnos por fecha</title>
</head>

<body class="body-interno"  th:each="datosProfesional : ${datosProfesional}">

	<!--Boton flotante de ws-->
	 <a href="https://wa.me/541157442608?text=Nani estética" target="_blank" class="boton-flotante">
	   <i class="fa-brands fa-whatsapp"></i>
	 </a>
  
<nav>
  <div class="navbar navbar1 navbar-expand-md">
    <div class="container-fluid navbar2">
      <button class="navbar-toggler mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
        aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse navbarlogo" id="navbarTogglerDemo01">
        <a th:href="@{/homeProfesional(email=${datosProfesional.email})}">
          <div class="imagen-logo ajuste-texto-menu">
            <img src="./imagenes/Nani-removebg-preview.png" class=" img-logo-nav" alt="">
          </div>
        </a>
        <ul class="navbar-nav navbar4 container-fluid p-0">
			<li class="nav-item">
            <a class="nav-link py-1 ajuste-texto-menu" th:href="@{/homeProfesional(email=${datosProfesional.email})}">Home</a>
          </li>
		  <li class="nav-item">
		     <a class="nav-link py-1 ajuste-texto-menu" th:href="@{/misdatosProfesional(email=${datosProfesional.email})}">Datos personales</a>
		  </li>
		  <li class="nav-item">
		  	 <a class="nav-link py-1 ajuste-texto-menu" th:href="@{/datosProfesional(email=${datosProfesional.email}, idProfesional=${datosProfesional.id})}">Datos profesionales</a>
		  </li>
          <li class="nav-item">
            <a class="nav-link py-1 ajuste-texto-menu" th:href="@{/listarPacientesOcultos(email=${datosProfesional.email})}">Clientes</a>
          </li>
          <li class="nav-item">
         <a class="nav-link  py-1 ajuste-texto-menu" th:href="@{/misturnosProfesional(email=${datosProfesional.email}, idProfesional=${datosProfesional.id})}">Turnos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link  py-1 ajuste-texto-menu" href="./misconsultas.html">Consultas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link  py-1 ajuste-texto-menu" th:href="@{/index}">Cerrar Sesion</a>
          </li>
        </ul>
      </div>
      
      
    </div>
  </div>
</nav>



  
  <main>
     <div class="">
      <h3>Turnos por fecha</h3>
      <div class="container-fluid">

<!--El iterStat es otro ietrador que agregamos en cada iteracion para darle un id unico a cada modal
que se genere en iteracion, esto evita que al tener varios turnos, se cruce la info entre ellos al
tener el mismo ID-->

<div class="d-block mb-4">
		<p class="fs-5">Selecciona una fecha para ver los turnos disponibles por horario, asi como tambien podra deshabilitar fechas o horarios.
		</p>
	
		<p class="mt-5 mb-2 text-center fs-5">Seleccione la fecha del turno</p>
		<form th:action="@{/turnosPorFecha}" class="mb-5 mt-0 d-flex justify-content-center">
		<div class="d-flex">
		<div class="me-2">
			<input type="date" class="form-control" name="fechaTurno"  placeholder="Fecha de turno">
		</div>
		<div class="ms-2">
			<button class="btn btn-primary">Buscar</button>
		</div>
		<input hidden type="text" id="idProfesional" name="idProfesional" th:value="${datosProfesional.id}"></input>
		<input hidden type="text" id="emailProfesional" name="emailProfesional" th:value="${datosProfesional.email}"></input>
		</div>
		</form>
			
		<form class="d-flex">
		<p class="fs-4 fw-bold ms-4 mb-0" >Fecha seleccionada: <span class="fw-normal" th:text="${fechaSeleccionada}"></span></p>
		<button type="button" data-bs-toggle="modal" data-bs-target="#confirmBackdrop" class="btn btn-danger ms-2">Deshabilitar</button>
		
		<!-- Modal Confirmar turno -->
		<div class="modal fade" id="confirmBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
		tabindex="-1" aria-labelledby="confirmBackdropLabel" aria-hidden="true">
		<div class="modal-dialog">
		  <div style="background-color: #ebdf9d;" class="modal-content">
			<div class="modal-header d-block text-center border border-0">
			  <img src="../imagenes/icons8-emoji-de-aprobacion-48.png" alt="">
			  <h1 class="modal-title fs-5 fw-bold" id="confirmBackdropLabel">Deshabilitar fecha</h1>
			</div>
			<div style="text-align: justify;" class="modal-body fs-6 lh-sm">
			  <span class="fw-bold">Estimado Usuario,</span><br><br>
			  
			  Estás a punto de deshabilitar la fecha seleccionada. Esto impedirá que los clientes puedan seleccionar turnos para ese día.
			  Ten en cuenta que si la fecha tiene turnos pendientes, estos serán cancelados automáticamente, y se enviará un email a los clientes
			  afectados para notificarles. Esta acción no generará multas para los clientes. Una vez que presiones "Aceptar", no podrás revertir
			  esta acción, así que por favor, verifica bien antes de continuar. Si no estás seguro, puedes presionar "Cancelar" para abortar la operación.
			  
			  <br><br>
			  <span class="fs-5 fw-bold">¿Estás seguro de que deseas proceder con la deshabilitación?</span>
			</div>
			<div class="modal-footer border border-0">
			  <button type="button"  class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
			  <a href="">
				<!-- Botón que llama al método para aceptar la confirmación -->
				<button type="submit" name="accionDelBoton" value="confirmarTurno" class="btn btn-primary">Aceptar</button>
			  </a>
			</div>
		  </div>
		</div>
		</div>
		
		<input hidden type="text"  name="idProfesional" th:value="${datosProfesional.id}"></input>
		<input hidden type="text"  name="emailProfesional" th:value="${datosProfesional.email}"></input>
		<input hidden type="text"  name="fechaSeleccionada" th:value="${fechaSeleccionada}"></input>
		</form>
	
		<ul>
		    <!-- Iterar sobre las entradas del Map -->
		    <li class="border-success mt-2" style="border-top: 5px solid; list-style-type: none;" th:each="entry, iterStat : ${turnosPorHorarioLaboral}">
				
				<form>
		        <!-- Imprime la clave del Map, que es el horario -->
		        <span class="fw-bold fs-4" >Hora: </span> <span class="fw-bold fs-4" th:text="${entry.key}"></span>
				<button type="button" data-bs-toggle="modal" th:attr="data-bs-target='#staticBackdrop' + ${iterStat.index}" class="btn btn-danger pt-0 pb-1 mb-2">x</button>
				
				
				<!-- Modal Cancelar horario -->
					           			<!-- se crea id unico al sumar la palabra staticBackdrop + iterStat.index que es la posicion de iteracion de este modal -->
					  						<div class="modal fade" th:id="'staticBackdrop' + ${iterStat.index}" data-bs-backdrop="static" data-bs-keyboard="false"
					  							tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
					  							<div class="modal-dialog">
					  								<div style="background-color: #ebdf9d;" class="modal-content">
					  									<div class="modal-header d-block  text-center border border-0">
					  										<img src="../imagenes/icons8-emoji-de-advertencia-48.png" alt="">
					  										<h1 class="modal-title fs-5 fw-bold" id="staticBackdropLabel">
					  											Deshabilitar horario</h1>
					  									</div>
					  									<div style="text-align: justify;" class="modal-body fs-6 lh-sm">
					  										<span class="fw-bold">Estimado Usuario,</span><br><br>
					  										
															Estás a punto de deshabilitar el horario seleccionado. Esto impedirá que los clientes puedan reservar turnos 
															en ese horario para la fecha seleccionada. Ten en cuenta que si el horario tiene turnos pendientes, estos serán
															cancelados automáticamente, y se enviará un email a los clientes afectados para notificarles. Esta acción no
															generará multas para los clientes. Una vez que presiones "Aceptar", no podrás revertir esta acción, así que por 
															favor, verifica bien antes de continuar. Si no estás seguro, puedes presionar "Cancelar" para abortar la operación.


															
															<br><br>
															
					  										<br><br>
					  										<span class="fs-5 fw-bold">¿Estás seguro de que deseas proceder con la deshabilitación?</span>
					  									</div>
					  									<div class="modal-footer border border-0">
					  										<button type="button" class="btn btn-danger"
					  											data-bs-dismiss="modal">Cerrar</button>
					  										<a href="">
					  											<!--Este boton es el que hace el llamado al metodo-->
					  											<button type="submit" name="accionDelBoton" value="cancelarTurno"  class="btn btn-primary">Aceptar</button>
					  												
					  										</a>
					  									</div>
					  								</div>
					  							</div>
					  						</div>
				</form>

				

				
				<div class="d-flex flex-wrap justify-content-center">
								  <div class="text-center" th:if="${#lists.isEmpty(entry.value)}">
									<p style="box-shadow: 7px 7px 15px rgba(0, 0, 0, 0.500);" class="fs-3 fw-light bg-success bg-gradient text-white">No tiene turnos en esta horario</p>
								  </div>
								  
								  <div class="ft-misturnos" th:each="turno : ${entry.value}">
								  
									<div th:if="${turno.estado.toString} == 'ASISTIDO'" class="bg-success gb-gradient text-center text-white">
									       Asistido
									   </div>
									   
									   <!-- Condición para estado 'Cancelado' -->
									   <div th:if="${turno.estado.toString == 'CANCELADO' && !turno.multa}" class="bg-black gb-gradient text-center text-white">
									       Cancelado
									   </div>

									   <div th:if="${turno.estado.toString == 'CANCELADO' && turno.multa}" class="bg-danger gb-gradient text-center text-white">
									       Cancelado
									   </div>
									   
									   <!-- Condición para estado 'Pendiente' -->
									   <div th:if="${turno.estado.toString} == 'PENDIENTE'" class="bg-warning gb-gradient text-center text-white">
									       Pendiente
									   </div>
								  		  
								  <div th:unless="${#lists.isEmpty(entry.value)}">
								   <ul class="ps-2 me-2 mt-3" >
								   <li class="list-unstyled d-flex"><strong>Id del turno:</strong>&nbsp <p class="m-0 p-0" th:text="${#strings.substring(turno.id, turno.id.length() - 12)}"></p> </li>
								   <li class="list-unstyled d-flex"><strong>Cliente:</strong>&nbsp <p class="m-0 p-0" th:text="${turno.cliente.nombre + ' ' + turno.cliente.apellido}"></p> </li>
								   <li class="list-unstyled d-flex"><strong>Dni cliente:</strong>&nbsp <p class="m-0 p-0" th:text="${turno.dni}"></p> </li>
								   <li class="list-unstyled d-flex"><strong>Fecha del turno:</strong>&nbsp <p class="m-0 p-0" th:text="${turno.fecha}"></p> </li>
								   <li class="list-unstyled d-flex"><strong>Hora del turno:</strong>&nbsp <p class="m-0 p-0" th:text="${turno.horario}"></p> </li>
								   <span><strong>Tratamientos:</strong></span>
								   <ul class="pb-3" style="list-style-type: disc;">
								   <li th:each="tratamientoAsistido : ${turno.tratamientos}">
								   <span th:text="${tratamientoAsistido.nombreTratamientos.DisplayName}"></span>
								   </li>
								   </ul>
								   </ul>
								   <div th:if="${turno.multa}" class="bg-danger gb-gradient text-center text-white">
								   	 ESTE TURNO POSEE UNA MULTA
								   </div>
								  </div>
								   </div>
								   </div>
		   				 </li>
					</ul>
	       				 </div>			
           				 </div>
           				 </div>


						
		



			
			  
          
		
   
        

    
    					<!--Modal mensaje de exito al registrarse	-->
    					
    <div class="modal fade" id="exitoModal" data-bs-backdrop="static" data-bs-keyboard="false"
	tabindex="-1" aria-labelledby="exitoModalLabel" aria-hidden="true"
	th:classappend="${showModalExito} ? 'show d-block' : ''" th:style="${showModalExito} ? 'display: block;' : 'display: none;'">
		<div class="modal-dialog">
			<div style="background-color: #ebdf9d;" class="modal-content">
				<div class="modal-header border border-0 d-flex justify-content-center">
					<img style="height: 70px; width: 70px;" class="" src="../imagenes/icons8-aprobado2 (1).gif" alt="imagen de aprobado">
				</div>
				<div class="modal-body text-black lh-sm">
					<p style="text-align: justify;" class="text-center" th:utext="${exito}"></p>
				</div>
				<div class="modal-footer border border-0">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
				</div>
			</div>
		</div>
	</div>
	
	<!--Modal mensajes de error-->
		
		<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true"
     th:classappend="${showModalError} ? 'show d-block' : ''" th:style="${showModalError} ? 'display: block;' : 'display: none;'">
    <div class="modal-dialog">
        <div style="background-color: #ebdf9d;" class="modal-content">
            <div class="modal-header border border-0 d-flex justify-content-center ">
			<img src="../imagenes/icons8-emoji-de-advertencia-48.png" alt="">
            </div>
            <div class="modal-body text-black lh-sm">
                <p class="text-center" th:utext="${error}"></p> <!--utext permite recibir texto en string con etiquetas html-->
            </div>
            <div class="modal-footer border border-0">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>


				<!--Script para modal de error-->
				
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
        var showModalError = /*[[${showModalError}]]*/ false;
        if (showModalError) {
            $('#errorModal').modal('show');
        }

        $('#errorModal').on('hidden.bs.modal', function () {
            $(this).remove();
        });
    });
    /*]]>*/
</script>
	
	
	
	
	<!--Scrip para el modal de mensaje de exito-->
			
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
        var showModalExito = /*[[${showModalExito}]]*/ false;
        if (showModalExito) {
            $('#exitoModal').modal('show');
        }

        $('#exitoModal').on('hidden.bs.modal', function () {
            $(this).remove();
        });
    });
    /*]]>*/
</script>
  </main>



  <footer class="d-flex row p-0">
      <div class="divfooter col-lg-6 mb-3">
        <p class="mb-3 text-center titulos-footer">CONTACTOS</p>
        <div class="mb-4">
          <p class="mb-0 text-center"><img class="iconos" src="/imagenes/icons8-gps-50.png" alt="">Rivadavia 730,
            B1625 Belén de Escobar</p>
          <p class="text-center mt-0">Provincia de Buenos Aires</p>
        </div>
        <div class="mb-4 text-center">
          <p><img class="iconos" src="/imagenes/icons8-teléfono-celular-50.png" alt="">+54 (11)5744-2608</p>
        </div>
        <div class="mb-4 text-center">
          <p><img class="iconos" src="/imagenes/icons8-whatsapp-50negro.png" alt="">+54 (11)5744-2608</p>
        </div>
        <div class="mb-4 text-center">
          <p class=""><img class="iconos pe-1" src="/imagenes/icons8-correo-50.png" alt="">estoesunaprueba@gmail.com</p>
        </div>
        <div class="text-center iconos3 mt-5 pb-4">
          <div class="">
            <a class="link" href="#"><img class=" iconos2" src="/imagenes/icons8-instagram-50 black.png" alt=""></a>
          </div>
          <div>
            <a class="link" href="#"><img class=" iconos2" src="/imagenes/icons8-tik-tok-50 black.png" alt=""></a>
          </div>
          <div>
            <a class="link" href="#"> <img class=" iconos2" src="/imagenes/icons8-facebook-50 black.png" alt=""></a>
          </div>
          <div>
            <a class="link" href="#"><img class=" iconos2" src="/imagenes/icons8-youtube-play-50 black.png" alt=""></a>
          </div>
        </div>
      </div>
	
    
	
    <div class="divfooter col-lg-6">
      <p class=" text-center mb-4 titulos-footer">UBICACIÓN</p>
	  <iframe class="w-100 rounded rounded-2" 
	     src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3294.081216388164!2d-58.80112362527934!3d-34.3484110440581!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bb61bb0df3ff2f%3A0xd3ede6174bb9f023!2sGMP%2C%20Rivadavia%20730%2C%20B1625%20Bel%C3%A9n%20de%20Escobar%2C%20Provincia%20de%20Buenos%20Aires!5e0!3m2!1ses!2sar!4v1722992578537!5m2!1ses!2sar"
	     width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
	   </iframe>
    </div>
  </footer>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
</body>
</html>